//Routes
function youtubeQuery(e,t){var n=require("https"),r={host:"www.googleapis.com",path:"/youtube/v3/search?q="+encodeURIComponent(e)+"&part=id&key="+youtubeApiKey};callback=function(e){var n="";e.on("data",function(e){n+=e});e.on("end",function(){t(n)})};n.request(r,callback).end()}function getUser(e,t){var n="",r={host:"ws.audioscrobbler.com",port:80,path:"/2.0/?method=user.gettopartists&user="+e+"&format=json&limit=20&api_key="+apikey},i;e=e||"WillsonSM";var s;myCache.get(e,function(e,t){s=t});if(s[e]){console.log(s[e]);artists=s[e].topartists.artist;i=artists[1].image[1];t()}else require("http").request(r,function(r){r.setEncoding("utf8");r.on("data",function(e){n+=e});r.on("end",function(){var r=0;n=JSON.parse(n);error=n.error;ermessage=n.message;myCache.set(e,n,604800);if(!error){artists=n.topartists.artist;i=artists[1].image[0];artists.forEach(function(e,n){youtubeQuery(e.name,function(n,i){n=JSON.parse(n);for(var s=0;s<n.items.length;s++){if(n.items[s].id.videoId&&r<=20){e.youtubeURL=n.items[s].id.videoId;r+=1;s=n.items.length}r===20&&t()}})})}})}).end()}var artists,username,error,ermessage,apikey="2e2b81823779d6575ebe2b404483874d",youtubeApiKey="AIzaSyBaolqWa8t7b8XbvBnk0EUAvPdm8f6i9B4",youtubeBaseURL="https://www.googleapis.com/youtube/v3/";NodeCache=require("node-cache"),myCache=new NodeCache;exports.index=function(e,t){t.render("index",{title:"LasTube"})};exports.getNamed=function(e,t){function n(e,n){!e||!n?t.render("error",{title:"Error"}):t.render("user",{title:e,artists:n})}username=e.params.name;getUser(username,function(){n(username,artists)})};